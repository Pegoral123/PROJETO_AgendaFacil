<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Agendamento de consulta</title>
    <link rel="stylesheet" href="style_agendamento.css" />
    <link rel="stylesheet" href="/nav.css" />
    <link rel="stylesheet" href="/rodape.css" />
    <link rel="icon" type="image/png" href="img/favicon.png" />
   
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <!-- nav -->
    <header>
      <div class="menu">
        <div class="hamburguer" id="hamburguer">
          <span></span>
          <span></span>
          <span></span>
        </div>
        <div class="logo">
          <h1>AgendaFácil NAF</h1>
        </div>
      </div>
    </header>

    <nav class="nav" id="nav">
      <ul>
        <h1 class="visually-hidden"></h1>

        <div
          class="d-flex flex-column flex-shrink-0 p-3 text-bg-dark"
          style="width: 300px"
        >
          <a
            href="/"
            class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-white text-decoration-none containerLogoUnifeso"
          >
            <img src="/img/UNIFESO.png" width="150" height="80" />
          </a>
          <hr />
          <div id="opcoesDisponiveisParaUsuarios">
            <ul class="nav nav-pills flex-column mb-auto"></ul>
          </div>
          <hr />
          <div class="dropdown">
            <ul class="dropdown-menu dropdown-menu-dark text-small shadow">
              <li><a class="dropdown-item" href="/index.html">Principal</a></li>
              <li><a class="dropdown-item" href="/feedback/feedback.html">Comentário</a></li>
              <li> <strong  id="nomeUsuario" style="color: white"> Usuário:</strong></li>
              <li><hr class="dropdown-divider" /></li>
              <li><a class="dropdown-item" href="/login/login.html">Sair</a></li>
            </ul>
          </div>
        </div>

        <div class="b-example-divider b-example-vr"></div>
        <div></div>
        <h1 class="text-align center" style="color: white"></h1>
      </ul>
    </nav>
    <!-- nav -->

    <!-- agendamento -->
    <main class="main-container">
      <section class="schedule">
        <h2>Horários Disponíveis</h2>
        <table id="scheduleTable">
          <thead>
            <tr>
              <th>Data</th>
              <th>Horário</th>
              <th>Status</th>
              <th>Ação</th>
            </tr>
          </thead>
          <tbody id="tabelaComHorarios">

          </tbody>
        </table>
      </section>

      <!-- agendamento -->




       <!-- agendamento relizado -->
      <section id="agendamentos" style="display: none">
        <h2>Agendamentos Realizados</h2>
        <ul id="appointmentsList" class="consulta-tabela"></ul>
      </section>
    </main>



    <!-- rodape -->
    <section class="rodape">
      <footer class="footer">
        <div class="logo">
          <img src="/img/UNIFESO-BRANCO.png" alt="Unifeso Logo" />
        </div>
        <div class="social-media">
          <ul class="list-inline">
            <li>
              <a href="https://www.facebook.com/feso.unifeso" target="_blank"
                ><i class="bi bi-facebook"></i
              ></a>
            </li>
            <li>
              <a href="https://www.instagram.com/feso.unifeso/" target="_blank">
                <i class="bi bi-instagram"></i></a
              >
            </li>
            <li>
              <a
                href="https://www.youtube.com/channel/UCqJHUIHPOB0SkdgiVExdSjw/featured"
                target="_blank"
                ><i class="bi bi-youtube"></i>
            </li>
          </ul>
        </div>
      </footer>
    </section>
    <!-- rodape -->

    <script src="/nav.js"></script>
    <script src="agendamento.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
  var EmailUsuarioLogadoAtual = localStorage.getItem("current_user_session");
  console.log(EmailUsuarioLogadoAtual);
  document.getElementById("nomeUsuario").innerText = document.getElementById("nomeUsuario").innerText.concat(EmailUsuarioLogadoAtual)

</script>
<script type="module">
  import * as horariosModule from "/js/horarios.js";
  import * as agendamento from "./agendamento.js";
  //Criando superuser
  if(localStorage.getItem("horariosDisponiveis")=="" || localStorage.getItem("horariosDisponiveis") == null){
      localStorage.setItem("horariosDisponiveis","[]")
      
  }
  adicionarHorariosNaTabela()
  agendamento.mostrarAgendamentosRealizadosNaTela()
  
  function adicionarHorariosNaTabela(){
    var horariosDisponiveis = localStorage.getItem("horariosDisponiveis");
    var horariosDisponiveis  = JSON.parse(horariosDisponiveis)
    var getTabelaComHorarios =document.getElementById("tabelaComHorarios")
    horariosDisponiveis.forEach(element => {
       var tr = document.createElement("tr")
       var data = element["data"]
       var hora =element["hora"]
       var tdElementData = document.createElement("td")
       tdElementData.innerText = data

       var tdElementHora = document.createElement("td")
       tdElementHora.innerText = hora

       var tdElementDisponivel = document.createElement("td")
       tdElementDisponivel.innerText =element["disponibilidade"]
       var dataComAspas =`'${data}'`

       var horaComAspas =`'${hora}'`
       var tdElementBotao = document.createElement("td")
       tdElementBotao.innerHTML = `<button class="schedule-btn" onclick="agendarAtendimento(this,${dataComAspas},${horaComAspas})">Agendar </button>`
       if(element["disponibilidade"] == "Indisponível"){
        var button = tdElementBotao.querySelector("button");
        button.disabled = true;
       }
       tr.appendChild(tdElementData)
       tr.appendChild(tdElementHora)
       tr.appendChild(tdElementDisponivel)
       tr.appendChild(tdElementBotao)
       getTabelaComHorarios.appendChild(tr)
     })
     
  }
  window.agendarAtendimento = agendamento.agendarAtendimento
  
</script>
  </body>
</html>

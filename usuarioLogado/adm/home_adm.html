<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin-AgendaFácil</title>
    <link rel="stylesheet" href="style_adm.css">
    <link rel="stylesheet" href="/nav.css" />
    <link rel="icon" type="image/png" href="img/favicon.png" />
    <link rel="stylesheet" href="/rodape.css" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css"
      rel="stylesheet"
    />

</head>


<body>
   <!-- nav -->
   <header>
    <div class="menu">
      <div class="hamburguer" id="hamburguer">
        <span></span>
        <span></span>
        <span></span>
      </div>
      <div class="logo">
        <h1>AgendaFácil NAF</h1>
      </div>
    </div>
  </header>

  <nav class="nav" id="nav">
    <ul>
      <h1 class="visually-hidden"></h1>

      <div
        class="d-flex flex-column flex-shrink-0 p-3 text-bg-dark"
        style="width: 300px"
      >
        <a
          href="/"
          class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-white text-decoration-none containerLogoUnifeso"
        >
          <img src="/img/UNIFESO.png" width="150" height="120" />
        </a>
        <hr />
        <div id="opcoesDisponiveisParaUsuarios">
          <ul class="nav nav-pills flex-column mb-auto"></ul>
        </div>
        <hr />
        <div class="dropdown">
          <ul class="dropdown-menu dropdown-menu-dark text-small shadow">
            <li><a class="dropdown-item" href="/index.html">Principal</a></li>
            <li><a class="dropdown-item" href="/feedback/feedback.html">Comentário</a></li>
             <strong  id="nomeUsuario" style="color: white"> Usuário:</strong>
           
            
            <li><hr class="dropdown-divider" /></li>
            <li><a class="dropdown-item" href="./index.html">Sair</a></li>
          </ul>
        </div>
      </div>

      <div class="b-example-divider b-example-vr"></div>
      <div></div>
      <h1 class="text-align center" style="color: white"></h1>
    </ul>
  </nav>
  <!-- nav -->
    <div class="admin-container">
        <div class="titulo">
          <h1>Área do Administrador</h1>
          <p>Gerencie os agendamentos e horários disponíveis do NAF.</p>
        </div>
            
        <!-- gerencianmento de Agendamentos -->
        <section class="appointments-section">
            <h2>Agendamentos Feitos</h2>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nome do Usuário</th>
                        <th>Email</th>
                        <th>Data</th>
                        <th>Horário</th>
                        <th>Status</th>
                        <th>Ação 1</th>
                        <th>Ação 2</th>
                    </tr>
                </thead>
                <tbody id="tabelaComHorarios">
                    
                </tbody>
            </table>
        </section>

        <!--horários -->
        <section class="add-schedule-section">
            <h2>Cadastrar Novo Horário</h2>
            <form  onsubmit="cadastrarHorarioDisponivel(event)">
                <label for="date">Data:</label>
                <input type="date" id="dataDisponivel" name="date" required>

                <label for="time">Horário:</label>
                <input type="time" id="horaDisponivel" name="time" required>

                <label for="availability">Disponibilidade:</label>
                <select id="availability" name="availability" required>
                    <option value="disponível">Disponível</option>
                    <option value="indisponível">Indisponível</option>
                </select>

                <button type="submit" class="align">Cadastrar Horário</button>
            </form>
        </section>
    </div>
    <section class="rodape">
      <footer class="footer">
        <div class="logo">
          <img src="/img/UNIFESO-BRANCO.png" alt="Unifeso Logo" />
        </div>
        <div class="social-media">
          <ul class="list-inline">
            <li>
              <a href="https://www.facebook.com/feso.unifeso" target="_blank"
                ><i class="bi bi-facebook"></i
              ></a>
            </li>
            <li>
              <a href="https://www.instagram.com/feso.unifeso/" target="_blank">
                <i class="bi bi-instagram"></i></a
              >
            </li>
            <li>
              <a
                href="https://www.youtube.com/channel/UCqJHUIHPOB0SkdgiVExdSjw/featured"
                target="_blank"
                ><i class="bi bi-youtube"></i>
            </li>
          </ul>
        </div>
      </footer>
    </section>
     <!-- rodape -->
</body>
<script src="/nav.js"></script>
<script>
  var EmailUsuarioLogadoAtual = localStorage.getItem("current_user_session");
  console.log(EmailUsuarioLogadoAtual);
  document.getElementById("nomeUsuario").innerText = document.getElementById("nomeUsuario").innerText.concat(EmailUsuarioLogadoAtual)

</script>
<script type="module">
  import * as horariosModule from "/js/horarios.js";
  import * as userModule from "/js/User.js";
  //Criando superuser
  if(localStorage.getItem("horariosDisponiveis")=="" || localStorage.getItem("horariosDisponiveis") == null){
      localStorage.setItem("horariosDisponiveis","[]")
      
  }
  async function cadastrarHorarioDisponivel(event) {
    event.preventDefault();
    var dataDisponivel =document.getElementById("dataDisponivel").value
    var horaDisponivel = document.getElementById("horaDisponivel").value
    var data = new Date(dataDisponivel)
    var dataDia =""
    if(data.getDate()<10){
      dataDia = `0${data.getDate()}`
      
    }else{
      dataDia = data.getDate()
    }
    data = dataDia+"/"+(data.getMonth()+1)+"/"+data.getFullYear() 
    var chavePrimaria = data.concat(horaDisponivel)
    var horariosDisponiveis = localStorage.getItem("horariosDisponiveis")
    var jaExisteEsseHorario = horariosModule.verificarSeHorarioJaExiste(chavePrimaria)
    if(jaExisteEsseHorario== false){
        horariosModule.salvarNovoHorarioDisponivel(chavePrimaria,data,horaDisponivel)
        alert("Horário cadastrado com sucesso!")
        window.location.replace("./home_adm.html");
        
    }else{
      alert("ERROR:Esse horário já foi cadastrado anteriormente")
    }
   
  }
  window.cadastrarHorarioDisponivel = cadastrarHorarioDisponivel
  adicionarHorariosNaTabela()
  function adicionarHorariosNaTabela(){
    var horariosDisponiveis = localStorage.getItem("horariosDisponiveis");
    console.log(horariosDisponiveis)
    var horariosDisponiveis  = JSON.parse(horariosDisponiveis)
    var getTabelaComHorarios =document.getElementById("tabelaComHorarios")
    var contador =1
    horariosDisponiveis.forEach(element => {
      if(element["disponibilidade"] == "Indisponível"){
       var tr = document.createElement("tr")
       var tdElementContador = document.createElement("td")
       tdElementContador.innerText = contador
       var nomeDoUsuario  = userModule.GetNomeDeUsuarioBaseadoEmEmail(element["usuarioComEsseHorario"])
       var tdElementNomeCompleto = document.createElement("td")
       tdElementNomeCompleto.innerText = nomeDoUsuario

       var emailDoUsuario  = element["usuarioComEsseHorario"]
       var tdElementEmailUsuario = document.createElement("td")
       tdElementEmailUsuario.innerText = emailDoUsuario

       var data = element["data"]
       var hora =element["hora"]
       var tdElementData = document.createElement("td")
       tdElementData.innerText = data

       var tdElementHora = document.createElement("td")
       tdElementHora.innerText = hora

       var tdElementDisponivel = document.createElement("td")
       tdElementDisponivel.innerText =element["statusAdm"]
       var dataComAspas =`'${data}'`

       var horaComAspas =`'${hora}'`
       var tdElementBotao = document.createElement("td")
       var chavePrimaria = data.concat(hora)
       tdElementBotao.innerHTML = `<button class="btn edit" onclick="admMarcarHorarioAgendadoComoConcluido('${chavePrimaria}')">Concluir atendimento</button>`
       var tdElementBotaoDeletar = document.createElement("td")
       tdElementBotaoDeletar.innerHTML = `<button class="btn edit" style="background-color:red" onclick="deletarHorarioBaseadoEmPk('${chavePrimaria}')">Deletar</button>`
      
       tr.appendChild(tdElementContador)
       tr.appendChild(tdElementNomeCompleto)
       tr.appendChild(tdElementEmailUsuario)
       tr.appendChild(tdElementData)
       tr.appendChild(tdElementHora)
       tr.appendChild(tdElementDisponivel)
       tr.appendChild(tdElementBotao)
       tr.appendChild(tdElementBotaoDeletar)
       getTabelaComHorarios.appendChild(tr)
       contador = contador+1
       
      }
     })
     
  }
  
  window.admMarcarHorarioAgendadoComoConcluido = horariosModule.admMarcarHorarioAgendadoComoConcluido
  window.deletarHorarioBaseadoEmPk = horariosModule.deletarHorarioBaseadoEmPk
</script>
</html>
